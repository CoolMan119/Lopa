os.loadAPI("/Lopa/System/APIs/Lopa")

--[[
Lopa
By: houseofkraft
]]--

local System = Lopa.System()

-- Display the boot animation
local img = {
  "/Lopa/System/Images/Boot/boot1",
  "/Lopa/System/Images/Boot/boot2",
  "/Lopa/System/Images/Boot/boot3",
  "/Lopa/System/Images/Boot/boot4",
  "/Lopa/System/Images/Boot/boot5",
  "/Lopa/System/Images/Boot/boot6",
  "/Lopa/System/Images/Boot/boot7",
  "/Lopa/System/Images/Boot/boot8"
}

for index, image in pairs( img ) do
  term.clear()
  term.setCursorPos( 1, 1 )
  if fs.exists( image ) ~= true then
    -- The image doesn't exist, try to redownload it
    local output, result = Lopa.Fix( image )
    if output == false then
      System.BSOD( "Error while re-downloading file '" .. image .. "' (" .. output .. ")")
    end
  end
  System.drawImage( image, 1, 1 )
  os.sleep( 0.1 )
end

-- Load the APIs
for index, api in pairs( fs.list( "/Lopa/System/APIs/" ) ) do
  local result, output = os.loadAPI( api )
  if result ~= true then
    System.BSOD( "Error while loading API '" .. api .. "' (" .. output .. ")" )
  end
end

-- Init
if fs.exists( "/Lopa/System/.firstuse" ) then
  local file = fs.open( "/Lopa/System/.firstuse", "r" )
  if ( file.readAll() ) == "true" then
    file.close()
    System.safeRun( "/Lopa/System/setup.lua" )
  else
    file.close()
    System.safeRun( "/Lopa/System/gui.lua" )
  end
else
  System.safeRun( "/Lopa/System/setup.lua" )
end
